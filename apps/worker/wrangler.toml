name = "neptu-worker-production"
main = "src/index.ts"
compatibility_date = "2024-12-30"

# Custom domain
routes = [
  { pattern = "worker.neptu.sudigital.com", custom_domain = true }
]

[triggers]
# Cron triggers (every 5 min + daily midnight):
# - Every 5 min: Colosseum heartbeat (small batches, spread over hour)
# - Daily at midnight: Daily reading generation
crons = ["*/5 * * * *", "0 0 * * *"]

[vars]
ENVIRONMENT = "development"
AZURE_OPENAI_ENDPOINT = "https://super-su.cognitiveservices.azure.com/"
AZURE_OPENAI_DEPLOYMENT = "gpt-4o-mini"
AZURE_OPENAI_API_VERSION = "2024-04-01-preview"
# Colosseum Agent Info (non-secret)
COLOSSEUM_AGENT_ID = "206"
COLOSSEUM_AGENT_NAME = "Neptu"
# Secrets stored in .dev.vars (local) or Cloudflare secrets (production):
# - AZURE_OPENAI_API_KEY
# - COLOSSEUM_API_KEY

[[d1_databases]]
binding = "DB"
database_name = "neptu-dev"
database_id = "7567d7ff-6845-4dad-bfdf-8b65cd4a2645"

[[kv_namespaces]]
binding = "CACHE"
id = "89c3d0b14d734b5e8577e878d1b6203c"
preview_id = "b4a8eea275004dc283b8db47c176caf5"

# Production environment
[env.production]
name = "neptu-worker-production"
routes = [
  { pattern = "worker.neptu.sudigital.com", custom_domain = true }
]

[env.production.triggers]
crons = ["*/5 * * * *", "0 0 * * *"]

[env.production.vars]
ENVIRONMENT = "production"
AZURE_OPENAI_ENDPOINT = "https://super-su.cognitiveservices.azure.com/"
AZURE_OPENAI_DEPLOYMENT = "gpt-4o-mini"
AZURE_OPENAI_API_VERSION = "2024-04-01-preview"
COLOSSEUM_AGENT_ID = "206"
COLOSSEUM_AGENT_NAME = "neptu"

[[env.production.d1_databases]]
binding = "DB"
database_name = "neptu-prod"
database_id = "accef3f0-658b-4765-b623-5f1768dce42c"

[[env.production.kv_namespaces]]
binding = "CACHE"
id = "89c3d0b14d734b5e8577e878d1b6203c"
