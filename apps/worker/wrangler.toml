name = "neptu-worker-production"
main = "src/index.ts"
compatibility_date = "2025-07-18"
compatibility_flags = ["nodejs_compat"]

# Custom domain
routes = [{ pattern = "worker.neptu.sudigital.com", custom_domain = true }]

[triggers]
# Cron triggers (max 5 on Cloudflare):
# - Every 3 min: Reply to comments on own posts
# - Every 5 min: Comment on other posts + votes (at min%15==0)
# - Every 10 min: Post new thread + other activity (at min%20==0)
# - Daily at midnight: Daily reading generation
crons = [
  "3,6,9,12,15,18,21,24,27,30,33,36,39,42,45,48,51,54 * * * *",
  "5,10,15,20,25,30,35,40,45,50,55 * * * *",
  "0,10,20,30,40,50 * * * *",
  "0 0 * * *",
]

[vars]
ENVIRONMENT = "development"
AZURE_OPENAI_ENDPOINT = "https://super-su.cognitiveservices.azure.com/"
AZURE_OPENAI_DEPLOYMENT = "gpt-4o-mini"
AZURE_OPENAI_API_VERSION = "2024-04-01-preview"
# Colosseum Agent Info (non-secret)
COLOSSEUM_AGENT_ID = "206"
COLOSSEUM_AGENT_NAME = "Neptu"
# Secrets stored in .dev.vars (local) or Cloudflare secrets (production):
# - AZURE_OPENAI_API_KEY
# - COLOSSEUM_API_KEY
# - COINGECKO_API_KEY

[[d1_databases]]
binding = "DB"
database_name = "neptu-dev"
database_id = "7567d7ff-6845-4dad-bfdf-8b65cd4a2645"

[[kv_namespaces]]
binding = "CACHE"
id = "89c3d0b14d734b5e8577e878d1b6203c"
preview_id = "b4a8eea275004dc283b8db47c176caf5"

# Production environment
[env.production]
name = "neptu-worker-production"
compatibility_flags = ["nodejs_compat"]
routes = [{ pattern = "worker.neptu.sudigital.com", custom_domain = true }]

[env.production.triggers]
crons = [
  "3,6,9,12,15,18,21,24,27,30,33,36,39,42,45,48,51,54 * * * *",
  "5,10,15,20,25,30,35,40,45,50,55 * * * *",
  "0,10,20,30,40,50 * * * *",
  "0 0 * * *",
]

[env.production.vars]
ENVIRONMENT = "production"
AZURE_OPENAI_ENDPOINT = "https://super-su.cognitiveservices.azure.com/"
AZURE_OPENAI_DEPLOYMENT = "gpt-4o-mini"
AZURE_OPENAI_API_VERSION = "2024-04-01-preview"
COLOSSEUM_AGENT_ID = "206"
COLOSSEUM_AGENT_NAME = "Neptu"

[[env.production.d1_databases]]
binding = "DB"
database_name = "neptu-prod"
database_id = "accef3f0-658b-4765-b623-5f1768dce42c"

[[env.production.kv_namespaces]]
binding = "CACHE"
id = "89c3d0b14d734b5e8577e878d1b6203c"
